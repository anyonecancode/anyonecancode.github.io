<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/app.be6f57c9c519f67899be.css">a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,i,iframe,img,ins,kbd,label,legend,li,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,ul,var,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:"";content:none}table{border-spacing:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em georgia,serif;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:2.25rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.45rem}pre{margin:0 0 1.45rem;font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:0;margin:0 1.45rem 1.45rem}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}body,html{height:100%;width:100%}html{font-family:open sans,sans-serif;color:#333}body{color:#555;margin:0;padding:1em 2em}a{color:#c94d2c;text-decoration:none}a:hover{text-decoration:underline}em{font-style:italic}header#siteheader{border-bottom:2px solid #5ebb86;margin:0 0 1.45em;padding:0 0 1.2em}header h1{font-family:Lucida Console,serif;font-size:2.5em;margin:0;padding:0}header#siteheader h1 a{color:#5ebb86;text-decoration:none}header h2{font-size:.8em;margin:0;padding:0}main{max-width:38em;padding:0 1.0875rem;line-height:1.4rem}footer{margin:1em 0 0;padding:1em 0;border-top:1px solid #5ebb86;font-size:.7em}footer p{margin:0 0 1em;padding:0;max-width:35em}.blog-post-content>p:first-child:first-letter{color:#bb7e5e;font-family:Georgia,serif;font-size:3em;float:left;padding:.1em .2em 0 0}article header{padding:0 0 1.2em}article header h1,h2{font-family:Helvetica,Arial,sans-serif;color:inherit}article header h2{font-style:italic}article.listing{margin:0 0 2em}article.listing h3{margin:0 0 .2em;padding:0}article.listing p{margin:.2em 0}.hidden{display:none}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.0.107"/><title data-react-helmet="true"></title><link rel="shortcut icon" href="/icons/icon-48x48.png"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link as="script" rel="preload" href="/webpack-runtime-1a2847ee7ea431260702.js"/><link as="script" rel="preload" href="/app-9c6e5fc42d4db6ca5e76.js"/><link as="script" rel="preload" href="/component---src-templates-posts-js-0c9fa25d68649e09ecc5.js"/><link as="fetch" rel="preload" href="/static/d/938/path---posts-jsonb-drafts-f-03-93d-aAVx98uP1UTu1R5WvBWq9HHzzE.json" crossOrigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><header id="siteheader"><h1><a href="/">Anyone Can Code</a></h1><h2>A personal website. Mostly about software.</h2></header><main><article><header><h1>Json in Postgres Use Case: Saving Drafts</h1><h2>January 20, 2019</h2></header><section class="blog-post-content"><p>Let's say we have an application where it generally makes sense to use a relational database. For instance, say we're running a coffee shop and our system takes care of managing inventory. We put this data to a lot of different uses, from customer-facing ones like displaying a menu to business-related purposes like deciding what what to include in next week's order. A relational database is a nice fit here as it gives us the flexibility to query on different combinations of attributes.</p>
<p>A coffee cake might have these attributes:</p>
<div class="gatsby-highlight" data-language="yaml"><pre style="counter-reset: linenumber NaN" class="language-yaml line-numbers"><code class="language-yaml"><span class="token key atrule">Name</span><span class="token punctuation">:</span> Can't Resist Coffee Cake
<span class="token key atrule">Category</span><span class="token punctuation">:</span> Food
<span class="token key atrule">Sub_Category</span><span class="token punctuation">:</span> Baked Goods
<span class="token key atrule">Supplier</span><span class="token punctuation">:</span> Pop Up Cafe Supply Co.
<span class="token key atrule">Cost</span><span class="token punctuation">:</span> 2.00 USD
Customer Price<span class="token punctuation">:</span> 3.50 USD
<span class="token key atrule">Description</span><span class="token punctuation">:</span> One of our best sellers<span class="token punctuation">,</span> this perfectly<span class="token punctuation">-</span>textured<span class="token punctuation">,</span>
  just<span class="token punctuation">-</span>the<span class="token punctuation">-</span>right<span class="token punctuation">-</span>sweetness coffee cake is the perfect accompaniment
  to your morning joe!</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>(Having only ever eaten at bakeries rather than worked at one, I'm sure my prices here are off, and that there'd be other attributes such as nutritional information we'd want to include, but this should work for illustrative purposes.)</p>
<p>Translating this to a database table, we might get a schema like this:</p>
<div class="gatsby-highlight" data-language="sql"><pre style="counter-reset: linenumber NaN" class="language-sql line-numbers"><code class="language-sql"> <span class="token keyword">Table</span> <span class="token string">"goods"</span>
     <span class="token keyword">Column</span>     <span class="token operator">|</span>          <span class="token keyword">Type</span>
<span class="token comment">----------------+------------------------+</span>
 id             <span class="token operator">|</span> <span class="token keyword">integer</span>                <span class="token operator">|</span>
 category       <span class="token operator">|</span> <span class="token keyword">integer</span>                <span class="token operator">|</span>
 sub_cat        <span class="token operator">|</span> <span class="token keyword">integer</span>                <span class="token operator">|</span>
 supplier       <span class="token operator">|</span> <span class="token keyword">integer</span>                <span class="token operator">|</span>
 cost_amt       <span class="token operator">|</span> <span class="token keyword">numeric</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>          <span class="token operator">|</span>
 cost_curr      <span class="token operator">|</span> currency               <span class="token operator">|</span>
 customer_price <span class="token operator">|</span> <span class="token keyword">numeric</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>          <span class="token operator">|</span>
 customer_curr  <span class="token operator">|</span> currency               <span class="token operator">|</span>
 name           <span class="token operator">|</span> <span class="token keyword">character</span> <span class="token keyword">varying</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">|</span>
 description    <span class="token operator">|</span> <span class="token keyword">text</span>                   <span class="token operator">|</span>
Indexes:
    <span class="token string">"goods_pkey"</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span> <span class="token keyword">btree</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token keyword">Foreign</span><span class="token operator">-</span><span class="token keyword">key</span> constraints:
    <span class="token string">"category"</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>category<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> categories<span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    <span class="token string">"sub_cat"</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>sub_cat<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> sub_categories<span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    <span class="token string">"supplier"</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>supplier<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> suppliers<span class="token punctuation">(</span>id<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>And the entry like this:</p>
<div class="gatsby-highlight" data-language="sql"><pre style="counter-reset: linenumber NaN" class="language-sql line-numbers"><code class="language-sql"><span class="token operator">-</span><span class="token punctuation">[</span> RECORD <span class="token number">1</span> <span class="token punctuation">]</span><span class="token comment">--+----------------------------------------------------------------------------------------------------------------------------------------</span>
id             <span class="token operator">|</span> <span class="token number">1</span>
category       <span class="token operator">|</span> <span class="token number">1</span>
sub_cat        <span class="token operator">|</span> <span class="token number">4</span>
supplier       <span class="token operator">|</span> <span class="token number">42</span>
cost_amt       <span class="token operator">|</span> <span class="token number">2.00</span>
cost_curr      <span class="token operator">|</span> USD
customer_price <span class="token operator">|</span> <span class="token number">3.50</span>
customer_curr  <span class="token operator">|</span> USD
name           <span class="token operator">|</span> Can't Resist Coffee Cake
description    <span class="token operator">|</span> One <span class="token keyword">of</span> our best sellers<span class="token punctuation">,</span> this perfectly<span class="token operator">-</span>textured just<span class="token operator">-</span>the<span class="token operator">-</span><span class="token keyword">right</span><span class="token operator">-</span>sweetness coffee cake <span class="token operator">is</span> the perfect accompaniment <span class="token keyword">to</span> your morning joe<span class="token operator">!</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Everything seems in order. The current state of our inventory is in an easily queryable, nicely normalized form. Assuming we also have tables to record orders placed, items sold, and so forth, the past state of our inventory is also accessible.</p>
<p>What about that description field, though? As I noted at the start of this post, in this example this system not only helps us manage business processes like inventory tracking, it also powers the menu. If we change the description in our current approach, that will instantly flow through to the menu as well. Maybe that's what we want, but it puts a lot of pressure on whoever is editing that description—don't hit "save" until the description is exactly right!</p>
<p>What we need is a "drafts" table to store data-in-progress that we don't want reflected across the rest of our system yet. What should this table look like? Maybe we should just copy over the <code class="language-text">goods</code> table and add a few columns specific to tracking drafts:</p>
<div class="gatsby-highlight" data-language="sql"><pre style="counter-reset: linenumber NaN" class="language-sql line-numbers"><code class="language-sql"> <span class="token keyword">Table</span> <span class="token string">"goods_drafts"</span>
     <span class="token keyword">Column</span>     <span class="token operator">|</span>          <span class="token keyword">Type</span>
<span class="token comment">----------------+--------------------------+</span>
 draft_id       <span class="token operator">|</span> <span class="token keyword">integer</span>                  <span class="token operator">|</span>
 good_id        <span class="token operator">|</span> <span class="token keyword">integer</span>                  <span class="token operator">|</span>
 category       <span class="token operator">|</span> <span class="token keyword">integer</span>                  <span class="token operator">|</span>
 sub_cat        <span class="token operator">|</span> <span class="token keyword">integer</span>                  <span class="token operator">|</span>
 supplier       <span class="token operator">|</span> <span class="token keyword">integer</span>                  <span class="token operator">|</span>
 cost_amt       <span class="token operator">|</span> <span class="token keyword">numeric</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>            <span class="token operator">|</span>
 cost_curr      <span class="token operator">|</span> currency                 <span class="token operator">|</span>
 customer_price <span class="token operator">|</span> <span class="token keyword">numeric</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>            <span class="token operator">|</span>
 customer_curr  <span class="token operator">|</span> currency                 <span class="token operator">|</span>
 name           <span class="token operator">|</span> <span class="token keyword">character</span> <span class="token keyword">varying</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span>   <span class="token operator">|</span>
 description    <span class="token operator">|</span> <span class="token keyword">text</span>                     <span class="token operator">|</span>
 created        <span class="token operator">|</span> <span class="token keyword">timestamp</span> <span class="token keyword">with</span> <span class="token keyword">time</span> zone <span class="token operator">|</span>
Indexes:
    <span class="token string">"goods_drafts_pkey"</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span> <span class="token keyword">btree</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token keyword">Foreign</span><span class="token operator">-</span><span class="token keyword">key</span> constraints:
     goods_drafts_good_id_fkey<span class="token string">" FOREIGN KEY (good_id) REFERENCES goods(id)
    "</span>category<span class="token string">" FOREIGN KEY (category) REFERENCES categories(id)
    "</span>sub_cat<span class="token string">" FOREIGN KEY (sub_cat) REFERENCES sub_categories(id)
    "</span>supplier" <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>supplier<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> suppliers<span class="token punctuation">(</span>id<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>This works but feels a bit heavy. Do we really need to duplicate all the columns from the <code class="language-text">goods</code> table? We never query on or update those columns when working with drafts. A draft is essentially immutable—we store any changes as a brand new entry in the table and we only ever read, not modify, previous versions.</p>
<p>Put another way, there's nothing especially <em>relational</em> about a draft. Normalizing our database schema makes it easier to sort, filter, and aggregate, but these use cases don't apply here. All we really want to do when saving a draft is to store the state of the record at that point in time, as a "blob" of data, if you will.</p>
<p>Applying this insight, let's take a different approach. Instead of replicating the <code class="language-text">goods</code> table in <code class="language-text">goods_drafts</code>, we can just store the contents of the draft as a JSON object:</p>
<div class="gatsby-highlight" data-language="sql"><pre style="counter-reset: linenumber NaN" class="language-sql line-numbers"><code class="language-sql"><span class="token keyword">Table</span> <span class="token string">"public.goods_drafts"</span>
  <span class="token keyword">Column</span>  <span class="token operator">|</span>            <span class="token keyword">Type</span>             <span class="token operator">|</span>
<span class="token comment">----------+-----------------------------+</span>
 draft_id <span class="token operator">|</span> <span class="token keyword">bigint</span>                      <span class="token operator">|</span>
 good_id  <span class="token operator">|</span> <span class="token keyword">integer</span>                     <span class="token operator">|</span>
 draft    <span class="token operator">|</span> jsonb                       <span class="token operator">|</span>
 created  <span class="token operator">|</span> <span class="token keyword">timestamp</span> <span class="token keyword">with</span> <span class="token keyword">time</span> zone    <span class="token operator">|</span>
Indexes:
    <span class="token string">"goods_drafts_pkey"</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span> <span class="token keyword">btree</span> <span class="token punctuation">(</span>draft_id<span class="token punctuation">)</span>
<span class="token keyword">Foreign</span><span class="token operator">-</span><span class="token keyword">key</span> constraints:
    <span class="token string">"goods_drafts_good_id_fkey"</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>good_id<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> goods<span class="token punctuation">(</span>id<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>PostgreSQL actually <a href="https://www.postgresql.org/docs/current/datatype-json.html">offers</a> two JSON types: <code class="language-text">json</code> and <code class="language-text">jsonb</code>. The <code class="language-text">json</code> type is essentially just a variant on the <code class="language-text">text</code> type with some additional validation, whereas <code class="language-text">jsonb</code> internally converts the values of JSON fields to their equivalent PostgreSQL data types. This makes for much more efficient storage and enable indexing and <a href="https://www.postgresql.org/docs/current/datatype-json.html#JSON-CONTAINMENT">containment testing</a>. As the documentation puts it, "In general, most applications should prefer to store JSON data as jsonb, unless there are quite specialized needs, such as legacy assumptions about ordering of object keys."</p>
<p>This flexibility is a really nice feature of PostgreSQL, allowing us to tailor our data storage strategy to different use cases within the same database. We can represent our data as JSON while we're editing it (which our UI layer is probably already doing anyway), then take full advantage of the traditional relational approach once our data is "live." As an added bonus, we've even accidentally added support for an "undo" feature in the UI—to restore a previous state, simply retrieve the JSON for an earlier version of the draft.</p>
<p>JSON + PostgreSQL: Letting us have our relational cake and eat NoSQL too ;-)</p></section></article></main><footer><p>Philip Schweiger’s web site, built with<!-- --> <a href="https://www.gatsbyjs.org">Gatsby</a> and hosted on<!-- --> <a href="http://github.com/anyonecancode/anyonecancode.github.io">Github</a>.</p><p>You can reach me via<!-- --> <a href="https://www.linkedin.com/in/philipschweiger/">LinkedIn</a> or at the email on my<!-- --> <a href="/files/schweiger_resume.pdf">resume</a>.</p><p class="hidden">Looking for more on this site? Browse all my<!-- --> <a href="/posts">posts</a>, or maybe just the post where I talk a bit<!-- --> <a href="/posts/about">about</a> myself or explain my<!-- --> <a href="/posts/anyonecancode">user name</a>.</p></footer></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-posts-js","jsonName":"posts-jsonb-drafts-f03","path":"/posts/jsonb-drafts"};window.dataPath="938/path---posts-jsonb-drafts-f-03-93d-aAVx98uP1UTu1R5WvBWq9HHzzE";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app.be6f57c9c519f67899be.css","/app-9c6e5fc42d4db6ca5e76.js"],"component---src-templates-posts-js":["/component---src-templates-posts-js-0c9fa25d68649e09ecc5.js"],"component---src-pages-404-js":["/component---src-pages-404-js-92747903cdf56749613c.js"],"component---src-pages-index-js":["/component---src-pages-index-js-a179be4fcfdd4bcbc842.js"],"pages-manifest":["/pages-manifest-325d5758e20aa864210a.js"]};/*]]>*/</script><script src="/component---src-templates-posts-js-0c9fa25d68649e09ecc5.js" async=""></script><script src="/app-9c6e5fc42d4db6ca5e76.js" async=""></script><script src="/webpack-runtime-1a2847ee7ea431260702.js" async=""></script></body></html>